{% extends 'base.html' %}

{% block container %}

<h1>Ski resorts</h1>
<div id="swissmap" style="height: 600px"></div>

<form action="./update_slope.html" method="POST">
    <p>Slope</p>
    <div><input type="checkbox" name="open" value="true"><p>open</p></div>
</form>

<script type="text/javascript">
    var themap = new L.Map('swissmap', {
        crs: L.CRS.EPSG3857,
        continuousWorld: true,
        worldCopyJump: false
    });
    var url = 'https://wmts20.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe/default/current/3857/{z}/{x}/{y}.jpeg';
    var tilelayer = new L.tileLayer(url);
    themap.addLayer(tilelayer);
    themap.setView(L.latLng(46.57591, 7.84956), 8);



    var skiresort = {{ skiresorts | safe }};
    var myLayer = L.geoJSON(skiresort, {
        style: slopeStyle,
        onEachFeature: onEachFeature
    }).addTo(themap);

    function slopeStyle (feature){
        let style = {weight: 7};

        if(feature.properties.aerialway !==null) {
            style.color = '#00ff22';
            return style
        }
        if(feature.properties.other_tags !== null){
            if(feature.properties.other_tags.includes('"piste:difficulty"=>"easy"')){
                style.color = '#0001ff';
            }
            else if(feature.properties.other_tags.includes('"piste:difficulty"=>"intermediate"')){
                style.color = '#ff0000';
            }
            else if(feature.properties.other_tags.includes('"piste:difficulty"=>"advanced"')){
                style.color = '#000000'
            }
            else{
                style.color = '#00ff22'
            }
            return style
        }
    }




    //highlight a go feature

    function highlightFeature(e) {
        var layer = e.target;

        layer.setStyle({
            weight: 10,
            color: '#666',
            dashArray: '',
            fillOpacity: 0.7
        });

        layer.bringToFront();

    }

    function resetHighlight(e) {
        myLayer.resetStyle(e.target);
    }

    // assign event handlers for mouseover, mouseout, click
    function onEachFeature(feature, layer) {
        if (feature.properties.name) {
            layer.bindPopup(feature.properties.name);
        }
        else{
            layer.bindPopup('test');
        }
             var content =

        layer.bindPopup(content)
        layer.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight,
            click: zoomToFeature
        });
    }

    function zoomToFeature(e) {
        //themap.fitBounds(e.target.getBounds());
    }

    function getSlopeDifficulty (other_tag){
        if(other_tag !== null){
            if(other_tag.includes('"piste:difficulty"=>"easy"')){
                return 'easy'
            }
            else if(other_tag.includes('"piste:difficulty"=>"intermediate"')){
                return 'intermediate'
            }
            else if(other_tag.includes('"piste:difficulty"=>"advanced"')){
                return 'advanced'
            }
            else{
                return null
            }
        }
    }

</script>
{% endblock %}